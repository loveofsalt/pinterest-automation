name: Pinterest Batch Pin Creator

on:
  # Trigger manually with workflow_dispatch
  workflow_dispatch:
    inputs:
      csv_file:
        description: 'Path to CSV file (e.g., pins/my_pins.csv)'
        required: true
        default: 'sample_pins.csv'
  
  # Or trigger on push to specific paths
  push:
    paths:
      - 'pins/**/*.csv'
      - 'sample_pins.csv'
    branches:
      - main
      - coco-bits-dev

jobs:
  create-pins:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.21'
        
    - name: Verify CSV file exists
      run: |
        CSV_PATH="${{ github.event.inputs.csv_file || 'sample_pins.csv' }}"
        if [ ! -f "$CSV_PATH" ]; then
          echo "‚ùå CSV file not found: $CSV_PATH"
          exit 1
        fi
        echo "‚úÖ Found CSV file: $CSV_PATH"
        echo "CSV_PATH=$CSV_PATH" >> $GITHUB_ENV
        
    - name: Show CSV contents
      run: |
        echo "üìã CSV Contents:"
        cat "$CSV_PATH"
        
    - name: Verify image files exist
      run: |
        echo "üîç Checking if all image files in CSV exist..."
        go run check_images.go "$CSV_PATH"
        
    - name: Create Pinterest Pins
      env:
        PINTEREST_APP_ID: ${{ secrets.PINTEREST_APP_ID }}
        PINTEREST_APP_SECRET: ${{ secrets.PINTEREST_APP_SECRET }}
        PINTEREST_REFRESH_TOKEN: ${{ secrets.PINTEREST_REFRESH_TOKEN }}
        PINTEREST_BOARD_ID: ${{ secrets.PINTEREST_BOARD_ID }}
        INPUT_CSV_PATH: ${{ env.CSV_PATH }}
      run: |
        echo "üöÄ Starting batch pin creation..."
        go run main.go